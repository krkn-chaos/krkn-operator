{"id":"krkn-operator-2q3","title":"Frontend: Authentication error handling and user feedback","description":"Implement comprehensive error handling and user feedback for authentication flows.\n\nRequirements:\n- Handle all authentication-related errors gracefully\n- Provide clear, user-friendly error messages\n- Implement toast/notification system for feedback\n- Add loading states for all auth operations\n- Implement retry logic for network errors\n\nError Types to Handle:\n\nRegistration Errors (400):\n- validation_error: 'Password must be at least 8 characters'\n- validation_error: 'First user must have admin role'\n- user_exists (409): 'This email is already registered'\n\nLogin Errors (401):\n- invalid_credentials: 'Invalid email or password'\n- account_disabled: 'Your account has been disabled. Contact admin.'\n\nGeneral Errors:\n- Network errors: 'Unable to connect. Check your connection.'\n- 500 errors: 'Server error. Please try again later.'\n- Timeout: 'Request timed out. Please try again.'\n\nUser Feedback:\n- Success notifications (green): 'Login successful', 'Registration complete'\n- Error notifications (red): API error messages\n- Warning notifications (yellow): 'Session expiring soon'\n- Info notifications (blue): 'Redirecting to login...'\n\nLoading States:\n- Button spinners during API calls\n- Disable forms during submission\n- Show skeleton loaders where appropriate\n- Full-page loader for initial auth check\n\nRetry Logic:\n- Network errors: show retry button\n- 500 errors: show retry button\n- Max 3 automatic retries with exponential backoff\n- Manual retry always available\n\nComponents to Create:\n- ErrorBoundary for auth pages\n- NotificationSystem/Toast component\n- LoadingButton component\n- RetryButton component\n\nAcceptance criteria:\n- All error types handled with specific messages\n- User never sees raw API error codes\n- Loading states shown for all async operations\n- Retry functionality works correctly\n- Notifications auto-dismiss after 5 seconds\n- Multiple notifications stack correctly\n- Error boundary catches React errors in auth flows","status":"open","priority":2,"issue_type":"task","owner":"tsebasti@redhat.com","created_at":"2026-02-26T13:39:48Z","created_by":"Tullio Sebastiani","updated_at":"2026-02-26T13:39:48Z","dependencies":[{"issue_id":"krkn-operator-2q3","depends_on_id":"krkn-operator-up8","type":"blocks","created_at":"2026-02-26T14:40:38Z","created_by":"Tullio Sebastiani","metadata":"{}"}]}
{"id":"krkn-operator-3x4","title":"Authentication Middleware","description":"An authentication middleware for jwt token must be developed and applied to the existing endpoints in the following way:\n\n\n","notes":"\t# user, admin\n         mux.HandleFunc(\"/api/v1/health\", handler.HealthCheck)\n\tmux.HandleFunc(\"/api/v1/clusters\", handler.GetClusters)\n\tmux.HandleFunc(\"/api/v1/nodes\", handler.GetNodes)\n\tmux.HandleFunc(\"/api/v1/targets\", handler.TargetsHandler)  // POST, GET - legacy endpoints (KrknTargetRequest)\n\tmux.HandleFunc(\"/api/v1/targets/\", handler.TargetsHandler) // GET /{uuid} - legacy endpoint (check status)\n\n\t// Provider config endpoints (KrknOperatorTargetProviderConfig)\n         # admin\n\tmux.HandleFunc(\"/api/v1/provider-config\", handler.ProviderConfigHandler)  // POST, GET\n\tmux.HandleFunc(\"/api/v1/provider-config/\", handler.ProviderConfigHandler) // GET /{uuid}\n         # GET user, admin\n        # PATCH admin \n\tmux.HandleFunc(\"/api/v1/providers\", handler.ProvidersRouter)              // GET, PATCH\n\tmux.HandleFunc(\"/api/v1/providers/\", handler.ProvidersRouter)\n\n\t// CRUD endpoints for KrknOperatorTarget (operator-managed targets)\n         # POST, PUT DELETE admin\n          # GET user, admin\n\tmux.HandleFunc(\"/api/v1/operator/targets\", handler.TargetsCRUDRouter)  // POST, GET\n\tmux.HandleFunc(\"/api/v1/operator/targets/\", handler.TargetsCRUDRouter) // GET, PUT, DELETE /{uuid}\n\n\t// Scenario management endpoints\n         # user, admin\n\tmux.HandleFunc(\"/api/v1/scenarios\", handler.PostScenarios)                // POST - list scenarios\n\tmux.HandleFunc(\"/api/v1/scenarios/detail/\", handler.PostScenarioDetail)   // POST /{scenario_name}\n\tmux.HandleFunc(\"/api/v1/scenarios/globals/\", handler.PostScenarioGlobals) // POST /{scenario_name}\n\tmux.HandleFunc(\"/api/v1/scenarios/run\", handler.ScenariosRunRouter)       // POST, GET\n\tmux.HandleFunc(\"/api/v1/scenarios/run/\", handler.ScenariosRunRouter)      // GET, DELETE /{jobId}","status":"closed","priority":1,"issue_type":"feature","owner":"tsebasti@redhat.com","created_at":"2026-02-26T11:13:08Z","created_by":"Tullio Sebastiani","updated_at":"2026-02-26T13:19:59Z","closed_at":"2026-02-26T13:19:59Z","close_reason":"Authentication middleware implemented and applied to all REST endpoints. Includes JWT validation, role-based authorization (admin/user), and method-based access control","dependencies":[{"issue_id":"krkn-operator-3x4","depends_on_id":"krkn-operator-ikb","type":"blocks","created_at":"2026-02-26T12:17:30Z","created_by":"Tullio Sebastiani","metadata":"{}"}]}
{"id":"krkn-operator-4ju","title":"Frontend: First admin registration page","description":"Implement the registration page for the first admin user (no authentication required).\n\nRequirements:\n- Form with fields: email, password, confirm password, name, surname, organization\n- Email validation (valid email format)\n- Password validation (min 8 characters, show strength indicator)\n- Password confirmation match check\n- Role is hardcoded to 'admin' (first user must be admin)\n- Organization is optional\n- Submit calls POST /api/v1/auth/register\n\nAPI Endpoint:\nPOST /api/v1/auth/register\nRequest: {\n  \"userId\": \"email@example.com\",\n  \"password\": \"password123\",\n  \"name\": \"First\",\n  \"surname\": \"Last\",\n  \"organization\": \"Org\" (optional),\n  \"role\": \"admin\"\n}\nResponse 201: { \"message\": \"...\", \"userId\": \"...\", \"role\": \"admin\" }\nError 400: { \"error\": \"validation_error\", \"message\": \"...\" }\nError 409: { \"error\": \"user_exists\", \"message\": \"...\" }\n\nUI Components:\n- Email input with validation\n- Password input with strength indicator\n- Confirm password input\n- Name, surname inputs\n- Organization input (optional)\n- Submit button (disabled until form valid)\n- Error message display\n- Success redirect to login\n\nValidation:\n- Email: valid email format\n- Password: min 8 chars, show strength (weak/medium/strong)\n- Passwords match\n- Name and surname required\n\nAcceptance criteria:\n- Form validates all inputs client-side\n- Shows validation errors inline\n- Calls API only with valid data\n- Handles API errors and displays user-friendly messages\n- On success: redirect to /login with success message\n- Password is never stored or logged","status":"open","priority":1,"issue_type":"task","owner":"tsebasti@redhat.com","created_at":"2026-02-26T13:37:21Z","created_by":"Tullio Sebastiani","updated_at":"2026-02-26T13:37:21Z","dependencies":[{"issue_id":"krkn-operator-4ju","depends_on_id":"krkn-operator-b3n","type":"blocks","created_at":"2026-02-26T14:40:33Z","created_by":"Tullio Sebastiani","metadata":"{}"}]}
{"id":"krkn-operator-6q1","title":"Frontend: Role-based UI components","description":"Implement components and utilities for role-based UI rendering.\n\nRequirements:\n- Create components to show/hide UI based on user role\n- Disable admin-only actions for regular users\n- Show role badge in user profile/header\n- Implement permission checks for UI elements\n\nComponents to Create:\n1. AdminOnly component - wraps admin-only UI elements\n2. usePermissions hook - returns permission check functions\n3. RoleDisplay component - shows user role badge\n\nAdminOnly Component Usage:\n\u003cAdminOnly\u003e\n  \u003cbutton\u003eDelete Target\u003c/button\u003e\n\u003c/AdminOnly\u003e\n\nusePermissions Hook Usage:\nconst { canCreate, canEdit, canDelete } = usePermissions();\n\u003cbutton disabled={!canCreate}\u003eCreate\u003c/button\u003e\n\nFeatures Requiring Role Check:\nAdmin Only:\n- Create/Edit/Delete targets (POST/PUT/DELETE /operator/targets)\n- Create provider config (POST /provider-config)\n- Update provider config (POST /provider-config/{uuid})\n- Update provider status (PATCH /providers/{name})\n\nUser + Admin:\n- View all resources (GET operations)\n- Run scenarios\n- View clusters and nodes\n\nUI Behavior:\n- Admin-only buttons: hidden or disabled for regular users\n- Admin badge shown in navbar/profile for admins\n- User badge shown for regular users\n- Tooltips explain why actions are disabled\n\nAcceptance criteria:\n- AdminOnly component correctly hides content for non-admins\n- Permission checks work consistently across app\n- Role badge displays correctly\n- Disabled buttons show helpful tooltips\n- No console errors from permission checks\n- Role changes reflected immediately in UI","status":"open","priority":1,"issue_type":"task","owner":"tsebasti@redhat.com","created_at":"2026-02-26T13:39:01Z","created_by":"Tullio Sebastiani","updated_at":"2026-02-26T13:39:01Z","dependencies":[{"issue_id":"krkn-operator-6q1","depends_on_id":"krkn-operator-jkx","type":"blocks","created_at":"2026-02-26T14:40:37Z","created_by":"Tullio Sebastiani","metadata":"{}"}]}
{"id":"krkn-operator-82z","title":"Frontend: Authentication E2E tests","description":"Implement end-to-end tests for all authentication flows.\n\nRequirements:\n- Test complete registration and login flows\n- Test protected route access\n- Test role-based UI rendering\n- Test session expiration handling\n- Test error scenarios\n\nTest Scenarios:\n\n1. First Admin Registration Flow:\n   - Check /is-registered returns false\n   - Fill registration form\n   - Submit and verify redirect to login\n   - Verify user can login with credentials\n\n2. Login Flow:\n   - Enter valid credentials\n   - Verify token stored in sessionStorage\n   - Verify redirect to dashboard\n   - Verify user info displayed\n\n3. Protected Routes:\n   - Try accessing /dashboard without auth\n   - Verify redirect to /login\n   - Login and verify redirect back to /dashboard\n\n4. Admin-Only Features:\n   - Login as regular user\n   - Verify admin buttons hidden/disabled\n   - Login as admin\n   - Verify admin buttons visible\n\n5. Session Expiration:\n   - Mock expired token\n   - Make API request\n   - Verify redirect to login with expired message\n\n6. Logout:\n   - Click logout\n   - Verify sessionStorage cleared\n   - Verify redirect to login\n   - Verify cannot access protected routes\n\n7. Error Handling:\n   - Submit login with wrong password\n   - Verify error message shown\n   - Submit registration with existing email\n   - Verify conflict error shown\n\nTesting Tools:\n- Cypress/Playwright for E2E tests\n- Mock API responses for predictable testing\n- Test data fixtures for users\n\nTest Coverage:\n- Happy paths (successful flows)\n- Error paths (validation, API errors)\n- Edge cases (expired tokens, network errors)\n- Role-based access control\n\nAcceptance criteria:\n- All authentication flows covered by E2E tests\n- Tests run in CI/CD pipeline\n- Tests use mock API (not real backend)\n- Test data cleaned up after each test\n- Tests are deterministic and reliable\n- All tests pass consistently","status":"open","priority":2,"issue_type":"task","owner":"tsebasti@redhat.com","created_at":"2026-02-26T13:40:08Z","created_by":"Tullio Sebastiani","updated_at":"2026-02-26T13:40:08Z","dependencies":[{"issue_id":"krkn-operator-82z","depends_on_id":"krkn-operator-6q1","type":"blocks","created_at":"2026-02-26T14:40:39Z","created_by":"Tullio Sebastiani","metadata":"{}"},{"issue_id":"krkn-operator-82z","depends_on_id":"krkn-operator-urc","type":"blocks","created_at":"2026-02-26T14:40:39Z","created_by":"Tullio Sebastiani","metadata":"{}"}]}
{"id":"krkn-operator-8xa","title":"Fix broken API and controller tests","description":"Multiple test suites are failing due to outdated test code:\n\n1. internal/api tests: Still using old clusterNames format instead of targetClusters map\n2. internal/controller tests: Scheme setup issues preventing Secret registration\n\nThese tests were broken before the KrknUser CRD work and need to be fixed separately.\n\nFiles affected:\n- internal/api/handlers_test.go\n- internal/controller/*_test.go","status":"open","priority":2,"issue_type":"task","owner":"tsebasti@redhat.com","created_at":"2026-02-26T11:28:11Z","created_by":"Tullio Sebastiani","updated_at":"2026-02-26T11:28:11Z"}
{"id":"krkn-operator-b3n","title":"Frontend: Setup authentication infrastructure","description":"Setup the authentication infrastructure for the krkn-operator-console frontend.\n\nRequirements:\n- Create authentication context/service for managing auth state\n- Implement JWT token storage (use sessionStorage for security)\n- Setup token management utilities (get, set, clear token)\n- Create authentication state management (logged in/out, user info, role)\n- Setup API client with automatic JWT header injection\n- Implement automatic 401 handling (redirect to login on token expiration)\n\nFiles to create:\n- src/context/AuthContext.tsx (or similar based on framework)\n- src/services/auth.service.ts\n- src/utils/api-client.ts\n- src/types/auth.types.ts\n\nReference:\n- See docs/api-authentication-spec.md for API details\n- Token format: 'Bearer \u003ctoken\u003e' in Authorization header\n- Token duration: 24 hours\n\nAcceptance criteria:\n- Auth context provides: login, logout, isAuthenticated, userRole, userName\n- API client automatically adds Authorization header to all requests\n- 401 responses automatically trigger logout and redirect to login\n- Token and user info persisted in sessionStorage","status":"open","priority":1,"issue_type":"task","owner":"tsebasti@redhat.com","created_at":"2026-02-26T13:36:41Z","created_by":"Tullio Sebastiani","updated_at":"2026-02-26T13:36:41Z"}
{"id":"krkn-operator-hvk","title":"KrknUser CRD","description":"Create a CRD named KrknUser that will work as authentication entity for the REST APIS. \nThis CRD will have a secret related to each instance of it containing the hash of the password. The KrknUser CRD will have the following attributes:\nuserId: will be the email of the user\n- Name\n- Surname\n- Organization\n- Role: user/admin\n- Created: date\n- Active: bool\n\nThe CRD will be marked with the following labels:\nkrkn.krkn-chaos.dev=user-account\nkrkn.krkn-chaos.dev=\u003crole\u003e\n\nRemember to update kustomize in order to have it installed via make install","status":"closed","priority":1,"issue_type":"feature","owner":"tsebasti@redhat.com","created_at":"2026-02-26T11:02:29Z","created_by":"Tullio Sebastiani","updated_at":"2026-02-26T11:27:59Z","closed_at":"2026-02-26T11:27:59Z","close_reason":"KrknUser CRD implementation complete with full test coverage"}
{"id":"krkn-operator-ikb","title":"Login rest endpoint","description":"# utility endpoints\n# /isRegistered\nwill check if any krkn.krkn-chaos.dev=admin labeled CRD is present \n# login endpoints\n## /register\nif no admin users are registered will allow authentication free registration (first registration) only for one admin user otherwise will be possible only for admin users to register new user (both user and admin level)\n## /login\nwill return a jwt token that will authenticate all the other REST calls.","status":"closed","priority":1,"issue_type":"feature","owner":"tsebasti@redhat.com","created_at":"2026-02-26T11:05:46Z","created_by":"Tullio Sebastiani","updated_at":"2026-02-26T11:43:10Z","closed_at":"2026-02-26T11:43:10Z","close_reason":"Login REST endpoints implemented with full test coverage. Includes /is-registered, /register, and /login endpoints, plus reusable JWT and password utilities in pkg/auth","dependencies":[{"issue_id":"krkn-operator-ikb","depends_on_id":"krkn-operator-hvk","type":"blocks","created_at":"2026-02-26T12:16:57Z","created_by":"Tullio Sebastiani","metadata":"{}"}]}
{"id":"krkn-operator-j01","title":"Frontend: Admin registration check page","description":"Implement the initial page that checks if an admin is registered and routes accordingly.\n\nRequirements:\n- On app load, call GET /api/v1/auth/is-registered\n- If registered === false: redirect to first admin registration page\n- If registered === true: redirect to login page\n- Show loading state while checking\n- Handle network errors gracefully (retry button)\n\nAPI Endpoint:\nGET /api/v1/auth/is-registered\nResponse: { \"registered\": boolean }\n\nUI Components:\n- Loading spinner/skeleton\n- Error message with retry button (if API call fails)\n\nRouting:\n- Not registered -\u003e /register/first-admin\n- Registered -\u003e /login\n\nAcceptance criteria:\n- Calls API on mount\n- Shows loading state during API call\n- Correctly routes based on registration status\n- Handles errors with user-friendly message\n- No authentication required for this check","status":"open","priority":1,"issue_type":"task","owner":"tsebasti@redhat.com","created_at":"2026-02-26T13:37:01Z","created_by":"Tullio Sebastiani","updated_at":"2026-02-26T13:37:01Z","dependencies":[{"issue_id":"krkn-operator-j01","depends_on_id":"krkn-operator-b3n","type":"blocks","created_at":"2026-02-26T14:40:31Z","created_by":"Tullio Sebastiani","metadata":"{}"}]}
{"id":"krkn-operator-jkx","title":"Frontend: Protected routes and navigation guards","description":"Implement route protection and authentication guards for the application.\n\nRequirements:\n- Create ProtectedRoute component that checks authentication\n- Redirect to /login if not authenticated\n- Store intended destination and redirect after login\n- Implement route-based role checking for admin-only pages\n- Add navigation guards to prevent unauthorized access\n\nRoute Types:\n1. Public routes: /login, /register/first-admin, /check-registration\n2. Protected routes (user + admin): /dashboard, /clusters, /scenarios, etc.\n3. Admin-only routes: /admin/users, /admin/settings, /operator/targets (create/edit)\n\nImplementation:\n- ProtectedRoute component wraps protected routes\n- Checks auth context for authentication status\n- Checks user role for admin-only routes\n- Redirects to /login with return URL if not authenticated\n- Shows 403 page if authenticated but insufficient permissions\n\nComponents to Create:\n- ProtectedRoute.tsx\n- AdminRoute.tsx (extends ProtectedRoute with role check)\n- UnauthorizedPage.tsx (403 page)\n\nRouting Structure Example:\n\n\nAcceptance criteria:\n- Unauthenticated users redirected to /login\n- Return URL preserved and used after login\n- Admin-only routes accessible only by admins\n- Non-admin users see 403 on admin routes\n- Auth check happens on every route change\n- No flashing of protected content before redirect","status":"open","priority":1,"issue_type":"task","owner":"tsebasti@redhat.com","created_at":"2026-02-26T13:38:44Z","created_by":"Tullio Sebastiani","updated_at":"2026-02-26T13:38:44Z","dependencies":[{"issue_id":"krkn-operator-jkx","depends_on_id":"krkn-operator-up8","type":"blocks","created_at":"2026-02-26T14:40:36Z","created_by":"Tullio Sebastiani","metadata":"{}"}]}
{"id":"krkn-operator-up8","title":"Frontend: Login page","description":"Implement the login page for user authentication.\n\nRequirements:\n- Form with email and password fields\n- Remember email checkbox (optional, store in localStorage)\n- Submit calls POST /api/v1/auth/login\n- On success: store token, user info, redirect to dashboard\n- Handle authentication errors (invalid credentials, account disabled)\n- Show session expired message if redirected from expired session\n\nAPI Endpoint:\nPOST /api/v1/auth/login\nRequest: {\n  \"userId\": \"email@example.com\",\n  \"password\": \"password123\"\n}\nResponse 200: {\n  \"token\": \"jwt.token.here\",\n  \"expiresAt\": \"2026-02-27T10:30:00Z\",\n  \"userId\": \"email@example.com\",\n  \"role\": \"admin\",\n  \"name\": \"First\",\n  \"surname\": \"Last\"\n}\nError 401: { \"error\": \"invalid_credentials\", \"message\": \"Invalid email or password\" }\nError 401: { \"error\": \"account_disabled\", \"message\": \"User account is disabled\" }\n\nOn Success:\n1. Store in sessionStorage:\n   - jwt_token\n   - user_role\n   - user_name\n   - user_email\n2. Update auth context state\n3. Redirect to /dashboard (or previous page if available)\n\nUI Components:\n- Email input\n- Password input (with show/hide toggle)\n- Remember me checkbox\n- Login button (disabled while submitting)\n- Error message display\n- Link to registration page (if applicable)\n- Session expired warning (if ?expired=true in URL)\n- Loading state during API call\n\nValidation:\n- Email: valid format\n- Password: not empty\n\nAcceptance criteria:\n- Form submits on Enter key\n- Shows loading state during login\n- Handles all error cases with clear messages\n- Stores auth data correctly\n- Updates auth context\n- Redirects to dashboard on success\n- Shows 'Session expired' banner if redirected from 401\n- Password is never stored or logged\n- Remember email works correctly","status":"open","priority":1,"issue_type":"task","owner":"tsebasti@redhat.com","created_at":"2026-02-26T13:37:46Z","created_by":"Tullio Sebastiani","updated_at":"2026-02-26T13:37:46Z","dependencies":[{"issue_id":"krkn-operator-up8","depends_on_id":"krkn-operator-b3n","type":"blocks","created_at":"2026-02-26T14:40:34Z","created_by":"Tullio Sebastiani","metadata":"{}"}]}
{"id":"krkn-operator-urc","title":"Frontend: Session expiration and logout","description":"Implement session expiration handling and logout functionality.\n\nRequirements:\n- Detect when JWT token expires (24 hours)\n- Handle 401 responses from API (expired token)\n- Show session expiration warning before expiry\n- Implement logout functionality\n- Clear all session data on logout\n\nToken Expiration Handling:\n- Token duration: 24 hours\n- expiresAt timestamp provided in login response\n- Show warning 5 minutes before expiration\n- On 401 response: clear session, redirect to login\n- Display 'Session expired, please login again' message\n\nLogout Functionality:\n- Logout button in navbar/user menu\n- Confirmation dialog (optional)\n- Clear sessionStorage (token, user data)\n- Reset auth context state\n- Redirect to /login\n\nSession Expiration Warning:\n- Start timer on login using expiresAt timestamp\n- Show banner/modal 5 minutes before expiration\n- Options: 'Continue session' (re-login) or 'Logout now'\n- Auto-logout if no action taken\n\nAPI Client Integration:\n- Intercept all 401 responses\n- Automatically trigger logout\n- Redirect to /login with ?expired=true\n- Preserve current URL for redirect after re-login\n\nComponents to Create:\n- SessionExpirationWarning component\n- LogoutButton component\n- useSessionTimer hook\n\nAcceptance criteria:\n- 401 responses trigger automatic logout\n- Session expiration warning shows at correct time\n- Logout clears all auth data\n- User redirected to login after logout\n- Session expired message shown when appropriate\n- Timer cancelled on manual logout\n- Warning dismissible with re-login option","status":"open","priority":1,"issue_type":"task","owner":"tsebasti@redhat.com","created_at":"2026-02-26T13:39:24Z","created_by":"Tullio Sebastiani","updated_at":"2026-02-26T13:39:24Z","dependencies":[{"issue_id":"krkn-operator-urc","depends_on_id":"krkn-operator-up8","type":"blocks","created_at":"2026-02-26T14:40:38Z","created_by":"Tullio Sebastiani","metadata":"{}"}]}
{"id":"krkn-operator-y97","title":"Login \u0026 Authentication","description":"Create a login and authentication method for krkn-operator REST APIs\n","status":"closed","priority":1,"issue_type":"epic","owner":"tsebasti@redhat.com","created_at":"2026-02-26T10:57:25Z","created_by":"Tullio Sebastiani","updated_at":"2026-02-26T13:29:23Z","closed_at":"2026-02-26T13:29:23Z","close_reason":"Epic completed: Full authentication system implemented with KrknUser CRD, login/register endpoints, JWT authentication, and middleware for all REST APIs"}
